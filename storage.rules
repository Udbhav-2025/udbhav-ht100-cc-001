rules_version = '2';

service firebase.storage {
  match /b/{bucket}/o {
    // Cases folder - allow public writes for grievance portal
    // Path: cases/{caseId}/{fileId}
    match /cases/{caseId}/{fileId} {
      // Allow all writes (public and authenticated) for grievance portal
      allow write: if true;
      
      // Deny all direct reads - files must be accessed via secure Cloud Function endpoint
      // This prevents direct access to storage URLs even if they are leaked
      // The Cloud Function performs RBAC checks and downloads files server-side
      allow read: if false;
    }
    
    // All other paths - allow all in emulator, restrict in production
    match /{allPaths=**} {
      // For emulator/development: allow all writes
      // In production, this should be restricted
      allow write: if true;
      
      // Deny all public reads
      // Files can only be accessed via signed URLs generated by Cloud Functions
      allow read: if false;
    }
  }
}

